import{_ as o,X as c,Y as i,Z as n,$ as s,a0 as a,a1 as t,D as p}from"./framework-dfc585d8.js";const l="/assets/github-token-d89276b9.png",u="/assets/personal-token-0e34638c.png",r="/assets/secrets-95831cfc.png",d="/assets/access-token-f0f3a164.png",m="/assets/workflow-5e05bed3.png",k="/assets/main-yml-7a7b8dc1.png",h="/assets/verify-83cabb65.png",b="/assets/error-50588b88.png",v={},_=n("p",null,"作者：benjamin",-1),g={href:"https://benjam1n.eu.org",target:"_blank",rel:"noopener noreferrer"},y=t('<blockquote><p>吾生也有涯，而知也无涯。</p></blockquote><h2 id="前言" tabindex="-1"><a class="header-anchor" href="#前言" aria-hidden="true">#</a> 前言</h2><p>正常我们利用 Vuepress 搭建一个文档博客之后，往往都是通过如下步骤来部署一篇博客：</p><ol><li><p>首先写文章；</p></li><li><p>写完文章之后生成静态文件，这里一般使用的是 <code>npm run build</code> 命令，但也有使用 <code>yarn build</code> 的；</p></li><li><p>将我们生成的静态文件推送到 Github Pages；</p></li><li><p>访问我们对应的网址，查看我们的推送是否成功。</p></li></ol><p>上述步骤看似简单，但一旦文档过多时，生成静态文件就十分耗费时间。这时候我们就想了，有不有一种方法，能够帮我们自动构建静态文件然后部署到 Github Pages 上呢。刚好，Github 官方提供了这个一个工具：Github Actions。利用它，我们就能够将重心转移到创作之后，每次创作之后推送到远程之后它就会自动后续工作，接下来我们就来看看如何利用 Github Action 实现自动部署我们的博客。</p><h2 id="生成-token" tabindex="-1"><a class="header-anchor" href="#生成-token" aria-hidden="true">#</a> 生成 Token</h2>',6),f=n("code",null,"Settings -> Developer settings -> Personal access tokens",-1),j={href:"https://github.com/settings/tokens",target:"_blank",rel:"noopener noreferrer"},x=n("code",null,"Generate new token",-1),w=n("code",null,"Expiration",-1),G=n("code",null,"No expiration",-1),z=n("code",null,"repo",-1),A=n("code",null,"Generate Token",-1),S=t('<p><img src="'+l+'" alt=""></p><p><img src="'+u+'" alt=""></p><h2 id="设置-secrets" tabindex="-1"><a class="header-anchor" href="#设置-secrets" aria-hidden="true">#</a> 设置 Secrets</h2><p>进入你存放你博客源码的项目，然后以此点击 <code>Settings -&gt; Secrets</code>，接着点击右上角的 <code>New repository secret</code>，新建一个 <code>Secret</code>。这里的名字要命名为 <code>ACCESS_TOKEN</code>，然后 <code>Value</code> 就是我们上一步中所生成的 Token。</p><p><img src="'+r+'" alt=""></p><p><img src="'+d+'" alt=""></p><h2 id="编写-action" tabindex="-1"><a class="header-anchor" href="#编写-action" aria-hidden="true">#</a> 编写 Action</h2><p>进入项目的的 <code>Actions</code> 选项，然后新建一个 <code>workflow</code>（我是因为已经建立过了，所以才是下面的界面），默认新建的 <code>workflow</code> 名字是 <code>main.yml</code> 这个可以自己自定义，根据你自己喜好来就行了。</p><p><img src="'+m+'" alt="image-20210826100501499"></p><p>生成后的 <code>main.yml</code> 位于项目的 <code>.github/workflows</code> 目录下。</p><p><img src="'+k+'" alt=""></p><p>接下来是在 <code>main.yml</code> 中填入如下信息即可，具体实例的可以参考我的博客实例：</p>',12),E={href:"https://github.com/ez4jam1n/ez4jam1n.github.io/",target:"_blank",rel:"noopener noreferrer"},N=t(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># name 可以自定义</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy GitHub Pages

<span class="token comment"># 触发条件：在 push 到 main/master 分支后，新的 Github 项目 应该都是 main，而之前的项目一般都是 master</span>
<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> main

<span class="token comment"># 任务</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build-and-deploy</span><span class="token punctuation">:</span>
    <span class="token comment"># 服务器环境：最新版 Ubuntu</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token comment"># 拉取代码</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">persist-credentials</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

      <span class="token comment"># 生成静态文件</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build
        <span class="token key atrule">run</span><span class="token punctuation">:</span> npm install <span class="token important">&amp;&amp;</span> npm run docs<span class="token punctuation">:</span>build

      <span class="token comment"># 部署到 GitHub Pages</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> JamesIves/github<span class="token punctuation">-</span>pages<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>action@releases/v3
        <span class="token key atrule">with</span><span class="token punctuation">:</span>
          <span class="token key atrule">ACCESS_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.ACCESS_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token comment"># 也就是我们刚才生成的 secret</span>
          <span class="token key atrule">BRANCH</span><span class="token punctuation">:</span> gh<span class="token punctuation">-</span>pages <span class="token comment"># 部署到 gh-pages 分支，因为 main 分支存放的一般是源码，而 gh-pages 分支则用来存放生成的静态文件</span>
          <span class="token key atrule">FOLDER</span><span class="token punctuation">:</span> docs/.vuepress/dist <span class="token comment"># vuepress 生成的静态文件存放的地方</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="验证" tabindex="-1"><a class="header-anchor" href="#验证" aria-hidden="true">#</a> 验证</h2><p>经过上面的的步骤配置好之后，就可以点击仓库的 <code>Actions</code> 来查看部署情况了。</p><p><img src="`+h+'" alt=""></p><p>如果是绿色的，说明自动部署成功了，如果是红色，那就说明部署失败。这个时候我们可以点进去看看部署失败的日志信息。</p><p>以我部署失败的一个实例来讲，可以看到主要是在部署步骤出了问题，我们就可以根据给出的错误日志来找出问题所在，然后找方法解决它了。</p><p>我这里错误的大体意思就是说我 Vuepress 项目下的的 <code>dist</code> 目录不存在，而解决方法则是在 Vuepress 的配置文件中的 <code>dist</code> 设置为 <code>docs/.vuepress/dist</code> 即可。</p><p><img src="'+b+'" alt=""></p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>以上就是关于 Vuepress + Github Actions 实现自动部署的所有内容了，如果对你有所帮助，那就帮忙点赞关注吧！</p><p>最后，贴出我的博客地址，可以去看看效果！</p>',11),T={href:"https://github.com/ez4jam1n/ez4jam1n.github.io",target:"_blank",rel:"noopener noreferrer"},V={href:"https://ez4jam1n.github.io/",target:"_blank",rel:"noopener noreferrer"},C=n("p",null,"关注公众号，获取最新文章更新",-1),B=n("img",{src:"https://github.com/ez4jam1n/ez4jam1n/blob/main/imgs/wepublic.gif",width:"200",alt:"公众号"},null,-1);function D(P,O){const e=p("ExternalLinkIcon");return c(),i("div",null,[_,n("p",null,[s("博客："),n("a",g,[s("studio"),a(e)])]),y,n("p",null,[s("要部署 Actions，那么它就需要有能够操作我们仓库的权限，因此需要提前设置个人访问令牌（Github personal access）。设置方法如下：进入 Github 后，点击我们的头像，然后依次进入 "),f,s("，对应地址就是 "),n("a",j,[s("Token 生成"),a(e)]),s("。然后点击右上方的 "),x,s("，接着输入 token 的名字，这个名字可以随意，不过还是推荐根据它的用途来命名。然后选 "),w,s("，也就是这个 Token 的有效期，如果我们要长期用，建议选为 "),G,s("，意思就是无期限。最后就是选权限，一般来讲这里选 "),z,s(" 就够了，但是如果你不确定，那就全都选上也行。然后点击 "),A,s("，会生成一个令牌，注意这里它只会出现一次，一旦刷新该网页就不见了，所以最好把它复制到你的备忘录备份一下，而且我们待会也是需要用到这个 Token 的。")]),S,n("blockquote",null,[n("p",null,[n("a",E,[s("https://github.com/ez4jam1n/ez4jam1n.github.io/"),a(e)])])]),N,n("ul",null,[n("li",null,[s("项目文件："),n("a",T,[s("https://github.com/ez4jam1n/ez4jam1n.github.io"),a(e)])]),n("li",null,[s("预览地址："),n("a",V,[s("https://ez4jam1n.github.io/"),a(e)])])]),C,B])}const H=o(v,[["render",D],["__file","20220403-vuepress-github-action.html.vue"]]);export{H as default};
